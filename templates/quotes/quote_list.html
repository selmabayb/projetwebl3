{% extends 'base.html' %}

{% block title %}Mes Devis - GaragePlus{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="mb-5">
        <h1 class="fw-bold mb-0">Mes Devis</h1>
        <p class="text-secondary">Consultez et validez vos estimations</p>
    </div>

    <!-- Stats Cards -->
    <div class="row g-4 mb-5">
        <div class="col-md-3">
            <div class="card bg-warning bg-opacity-10 border-0 h-100">
                <div class="card-body">
                    <h6 class="text-warning fw-bold text-uppercase mb-2">À Valider</h6>
                    <h2 class="fw-bold mb-0 text-dark">{{ stats.emitted }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success bg-opacity-10 border-0 h-100">
                <div class="card-body">
                    <h6 class="text-success fw-bold text-uppercase mb-2">Acceptés</h6>
                    <h2 class="fw-bold mb-0 text-dark">{{ stats.accepted }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-danger bg-opacity-10 border-0 h-100">
                <div class="card-body">
                    <h6 class="text-danger fw-bold text-uppercase mb-2">Refusés</h6>
                    <h2 class="fw-bold mb-0 text-dark">{{ stats.refused }}</h2>
                </div>
            </div>
        </div>
    </div>

    {% if quotes %}
    <div class="row g-4">
        {% for quote in quotes %}
        <div class="col-lg-6">
            <div
                class="glass-card p-4 hover-lift position-relative h-100 border-start border-4 {% if quote.is_accepted_by_client %}border-success{% elif quote.is_refused_by_client %}border-danger{% elif quote.is_validated_by_manager %}border-warning{% else %}border-secondary{% endif %}">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <span
                        class="badge {% if quote.is_accepted_by_client %}bg-success{% elif quote.is_refused_by_client %}bg-danger{% elif quote.is_validated_by_manager %}bg-warning{% else %}bg-secondary{% endif %} rounded-pill">
                        {% if quote.is_accepted_by_client %}Accepté{% elif quote.is_refused_by_client %}Refusé{% elif quote.is_validated_by_manager %}En attente de réponse{% else %}Brouillon{% endif %}
                    </span>
                    <small class="text-secondary">{{ quote.created_at|date:"d/m/Y" }}</small>
                </div>

                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="fw-bold mb-0">{{ quote.quote_number }}</h5>
                    <h4 class="fw-bold text-primary mb-0">{{ quote.total_amount_ttc }} €</h4>
                </div>

                <p class="text-secondary small mb-3">
                    <i class="fa-solid fa-car me-1"></i> {{ quote.case.vehicle.brand }} {{ quote.case.vehicle.model }}<br>
                    <i class="fa-solid fa-folder me-1"></i> Dossier #{{ quote.case.id }}
                </p>

                <div class="d-grid mt-4">
                    <a href="{% url 'quotes:quote_detail' quote.id %}" class="btn btn-outline-primary fw-bold">
                        Voir le détail
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-5">
        <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center mb-4"
            style="width: 80px; height: 80px;">
            <i class="fa-solid fa-file-invoice-dollar text-secondary fa-2x opacity-50"></i>
        </div>
        <h4>Aucun devis</h4>
        <p class="text-secondary mb-4">Vous n'avez aucun devis pour le moment.</p>
    </div>
    {% endif %}
</div>
{% endblock %}